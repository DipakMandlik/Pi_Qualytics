Pi-Qualytics - Complete Project Deep Dive
ğŸ¯ Project Overview
Pi-Qualytics is an enterprise-grade Data Quality Management Platform built with modern web technologies and powered by Snowflake. It provides comprehensive data quality monitoring, automated profiling, AI-driven insights, and intelligent investigation capabilities.

Core Value Proposition
Automated Data Quality Monitoring: 65+ pre-configured rules across 6 quality dimensions
AI-Powered Investigation: "Antigravity" AI engine for root cause analysis
3-Layer Medallion Architecture: Bronze â†’ Silver â†’ Gold data transformation
Real-time Dashboards: Executive scorecards and detailed quality metrics
Scheduled Automation: Automated profiling and custom checks
ğŸ—ï¸ Architecture Overview
Technology Stack
Frontend
Framework: Next.js 16.1.1 (App Router)
UI Library: React 19.2.3
Styling: TailwindCSS 4.0 with custom design system
Components: Radix UI primitives + shadcn/ui
Charts: Recharts 3.6.0
Icons: Lucide React
Backend
Runtime: Node.js (Next.js API Routes)
Database: Snowflake (via snowflake-sdk 2.3.3)
AI Integration:
Google Gemini API (@google/generative-ai)
Ollama (local LLM support)
Connection Pooling: Custom singleton pool manager
Data Layer (Snowflake)
BANKING_DW (Business Data)
â”œâ”€â”€ BRONZE â†’ Raw data layer (all STRING columns)
â”œâ”€â”€ SILVER â†’ Cleansed, type-safe data with DQ scores
â””â”€â”€ GOLD â†’ Analytics-ready views
DATA_QUALITY_DB (DQ Framework)
â”œâ”€â”€ DQ_CONFIG â†’ Rules, datasets, schedules
â”œâ”€â”€ DQ_METRICS â†’ Results, profiling, summaries
â”œâ”€â”€ DQ_ENGINE â†’ Stored procedures
â””â”€â”€ DB_METRICS â†’ AI observability
ğŸ“‚ Project Structure
Pi-Qualytics-main/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ api/                      # API Routes (65+ endpoints)
â”‚   â”‚   â”œâ”€â”€ dq/                   # Data Quality APIs (28 endpoints)
â”‚   â”‚   â”œâ”€â”€ snowflake/            # Snowflake connection APIs (17 endpoints)
â”‚   â”‚   â”œâ”€â”€ antigravity/          # AI investigation APIs (7 endpoints)
â”‚   â”‚   â”œâ”€â”€ observability/        # Metrics & monitoring (6 endpoints)
â”‚   â”‚   â””â”€â”€ scheduler/            # Schedule management
â”‚   â”œâ”€â”€ datasets/                 # Dataset detail pages
â”‚   â”œâ”€â”€ governance/               # Data governance UI
â”‚   â”œâ”€â”€ intelligence/             # AI insights UI
â”‚   â””â”€â”€ page.tsx                  # Main dashboard
â”‚
â”œâ”€â”€ components/                   # React Components (45 files)
â”‚   â”œâ”€â”€ fields/                   # Form fields & inputs (10 components)
â”‚   â”œâ”€â”€ layout/                   # Layout components (Sidebar, TopNav)
â”‚   â”œâ”€â”€ dashboard/                # Dashboard widgets
â”‚   â”œâ”€â”€ ui/                       # Base UI components (13 shadcn components)
â”‚   â”œâ”€â”€ AntigravityInvestigation.tsx  # AI investigation modal
â”‚   â””â”€â”€ AntigravityInsights.tsx   # AI insights panel
â”‚
â”œâ”€â”€ lib/                          # Utility Libraries (31 files)
â”‚   â”œâ”€â”€ antigravity/              # AI SQL generation engine (11 files)
â”‚   â”‚   â”œâ”€â”€ sql-generator.ts     # AI-powered SQL generation
â”‚   â”‚   â”œâ”€â”€ schema-reader.ts     # Schema introspection
â”‚   â”‚   â”œâ”€â”€ intent-classifier.ts # Question intent analysis
â”‚   â”‚   â””â”€â”€ answer-interpreter.ts # Executive answer generation
â”‚   â”œâ”€â”€ snowflake.ts              # Snowflake connection manager
â”‚   â”œâ”€â”€ server-config.ts          # Server configuration
â”‚   â”œâ”€â”€ env-validator.ts          # Environment validation
â”‚   â”œâ”€â”€ cache.ts                  # Response caching
â”‚   â”œâ”€â”€ retry.ts                  # Retry logic
â”‚   â””â”€â”€ job-queue.ts              # Background job processing
â”‚
â”œâ”€â”€ sql/production/               # Snowflake Setup Scripts (12 files)
â”‚   â”œâ”€â”€ 00_MASTER_SETUP.sql      # Setup guide
â”‚   â”œâ”€â”€ 01_Environment_Setup.sql  # Warehouses, databases, stages
â”‚   â”œâ”€â”€ 02_Data_Loading.sql       # CSV data loading
â”‚   â”œâ”€â”€ 03_Silver_Layer_Setup.sql # Type-safe transformations
â”‚   â”œâ”€â”€ 04_Gold_Layer_Setup.sql   # Analytics views
â”‚   â”œâ”€â”€ 05_Config_Tables.sql      # DQ configuration
â”‚   â”œâ”€â”€ 06_Metrics_Tables.sql     # Metrics tracking
â”‚   â”œâ”€â”€ 07_Populate_Configuration.sql # 65+ rule mappings
â”‚   â”œâ”€â”€ 08_Execution_Engine.sql   # Main DQ processor
â”‚   â”œâ”€â”€ 09_Profiling_Custom_Scanning.sql # Profiling procedures
â”‚   â”œâ”€â”€ 10_Scheduling_Tasks.sql   # Automated scheduling
â”‚   â””â”€â”€ 11_Observability_AI_Insights.sql # AI insights generation
â”‚
â”œâ”€â”€ docs/                         # Documentation (18 files)
â”‚   â”œâ”€â”€ QUICKSTART.md            # 5-minute setup
â”‚   â”œâ”€â”€ SETUP_COMPLETE.md        # Comprehensive 12-step guide
â”‚   â”œâ”€â”€ ENVIRONMENT_SETUP.md     # Environment variables
â”‚   â””â”€â”€ troubleshooting/         # 10 troubleshooting guides
â”‚
â”œâ”€â”€ scripts/                      # Utility scripts (19 files)
â”œâ”€â”€ public/                       # Static assets
â”œâ”€â”€ .env.local                    # Environment configuration
â”œâ”€â”€ package.json                  # Dependencies
â”œâ”€â”€ tsconfig.json                 # TypeScript config
â””â”€â”€ next.config.ts                # Next.js config
ğŸ”‘ Key Features & Capabilities
1. Data Quality Monitoring
Quality Dimensions (65+ Rules)
Completeness (15 rules)

Null checks on critical columns
Required field validation
Column-level completeness scoring
Uniqueness (10 rules)

Primary key validation
Composite key checks
Duplicate detection
Validity (20 rules)

Email format validation
Phone number format
Date format checks
Allowed values validation
Range checks
Consistency (10 rules)

Foreign key validation
Cross-table relationships
Logical consistency checks
Freshness (5 rules)

Load timestamp validation
Data staleness detection
SLA compliance
Volume (5 rules)

Row count anomaly detection
Volume trend analysis
Execution Modes
Full Execution: All datasets, all rules
Dataset-Specific: Single dataset profiling
Rule-Type Filtering: Only specific quality dimensions
Critical-Only: High-priority datasets
Ad-Hoc Custom: Single rule with threshold override
2. Antigravity AI Engine ğŸš€
The crown jewel of the platform - an intelligent SQL generation and investigation system.

Architecture
User Question
    â†“
Intent Classifier (Gemini/Ollama)
    â†“
Schema Introspection (INFORMATION_SCHEMA)
    â†“
SQL Generator (AI-powered with validation)
    â†“
Query Execution (Snowflake)
    â†“
Answer Interpreter (Executive format)
    â†“
Executive Answer Block (UI)
Key Components
1. Intent Classification (lib/antigravity/intent-classifier.ts)

Analyzes user questions to determine intent type
Types: ROOT_CAUSE, TREND, COMPARISON, IMPACT, DISTRIBUTION
Extracts metrics, time windows, and confidence scores
2. Schema Reader (
lib/antigravity/schema-reader.ts
)

Introspects Snowflake INFORMATION_SCHEMA
Builds schema registry with fully qualified names
Validates columns before SQL generation
CRITICAL: Antigravity REFUSES to generate SQL without schema validation
3. SQL Generator (
lib/antigravity/sql-generator.ts
)

AI-powered SQL generation using Gemini
Strict validation rules (no DROP, DELETE, INSERT, UPDATE)
Fallback to templates disabled (Strict Gemini Mode)
Multi-model support: gemini-1.5-flash, gemini-1.0-pro, gemini-pro
4. Answer Interpreter (lib/antigravity/answer-interpreter.ts)

Transforms raw SQL results into executive summaries
Generates 4-part answers:
What Happened: Factual summary
Why It Happened: Root cause analysis
What Is Impacted: Business impact
What Should Be Done: Actionable recommendations
5. Investigation UI (
components/AntigravityInvestigation.tsx
)

Modal-based investigation interface
Guided questions + free-form input
Intent preview before execution
AI provider selection (Gemini/Ollama)
Executive answer blocks with collapsible charts
AI Provider Support
Gemini (Fast, cloud-based)

Requires GEMINI_API_KEY
Models: gemini-1.5-flash, gemini-1.0-pro
Automatic retry with rate limit handling
Ollama (Private, local)

Requires local Ollama server
Health check before execution
Offline detection with user guidance
3. Dashboard & Visualization
Main Dashboard (
app/page.tsx
)
Real-time KPI Cards:
Overall Quality Score (circular gauge)
Coverage Score (shield icon)
Validity Score (alert triangle)
Attention Items: Critical issues requiring action
Last Scan Time: IST timezone display
Scan Now: Manual trigger for DQ checks
Circular Metric Cards (
components/dashboard/CircularMetricCard.tsx
)
LED-style circular progress indicators
Trend indicators (vs last week)
Color-coded by metric type (green, blue, amber)
Animated transitions
Charts & Visualizations
Line charts for trends
Bar charts for distributions
Gauge charts for scores
Reference lines for thresholds
4. Scheduling System
Schedule Types
Profiling: Automated column profiling
Custom Checks: Rule-based validation
Full Scans: All rules execution
Anomaly Detection: Volume/freshness checks
Frequency Options
Hourly
Daily (with time selection)
Weekly (with day selection)
Implementation
Snowflake TASKS for execution
SP_PROCESS_DUE_SCHEDULES: Task processor (runs every minute)
Schedule configuration in DQ_CONFIG.SCAN_SCHEDULES
Execution tracking in DQ_METRICS.DQ_RUN_CONTROL
5. API Architecture
Connection Management (
lib/snowflake.ts
)
Singleton Connection Pool: Reuses connections
Auto-reconnect: Validates connection health
Context Management: Warehouse, database, schema setup
Error Handling: Comprehensive error messages
Configuration (
lib/server-config.ts
)
In-Memory Config: Runtime configuration
Environment Fallback: Persistent config from .env
Config Source Tracking: Debug which config is active
Caching (
lib/cache.ts
)
In-memory cache for API responses
Configurable TTL (default: 5 minutes)
Cache invalidation on data changes
Retry Logic (
lib/retry.ts
)
Exponential backoff
Configurable max retries
Error-specific retry strategies
ğŸ—„ï¸ Database Schema
DQ_CONFIG Schema (Configuration)
-- Rule definitions
RULE_MASTER
â”œâ”€â”€ RULE_ID (PK)
â”œâ”€â”€ RULE_NAME
â”œâ”€â”€ RULE_TYPE (Completeness, Uniqueness, etc.)
â”œâ”€â”€ SEVERITY (Critical, High, Medium, Low)
â””â”€â”€ IS_ACTIVE
-- SQL templates for dynamic rule execution
RULE_SQL_TEMPLATE
â”œâ”€â”€ RULE_ID (FK)
â”œâ”€â”€ SQL_TEMPLATE (Parameterized SQL)
â””â”€â”€ PARAMETERS (JSON)
-- Dataset configuration
DATASET_CONFIG
â”œâ”€â”€ DATASET_ID (PK)
â”œâ”€â”€ DATABASE_NAME
â”œâ”€â”€ SCHEMA_NAME
â”œâ”€â”€ TABLE_NAME
â”œâ”€â”€ IS_CRITICAL
â””â”€â”€ BUSINESS_OWNER
-- Rule mappings (65+ mappings)
DATASET_RULE_CONFIG
â”œâ”€â”€ CONFIG_ID (PK)
â”œâ”€â”€ DATASET_ID (FK)
â”œâ”€â”€ RULE_ID (FK)
â”œâ”€â”€ COLUMN_NAME
â”œâ”€â”€ THRESHOLD_VALUE
â””â”€â”€ IS_ACTIVE
-- Scheduling
SCAN_SCHEDULES
â”œâ”€â”€ SCHEDULE_ID (PK)
â”œâ”€â”€ DATASET_ID (FK)
â”œâ”€â”€ SCAN_TYPE (Profiling, Custom, Full)
â”œâ”€â”€ FREQUENCY (Hourly, Daily, Weekly)
â”œâ”€â”€ CRON_EXPRESSION
â””â”€â”€ IS_ACTIVE
DQ_METRICS Schema (Results & Tracking)
-- Execution tracking
DQ_RUN_CONTROL
â”œâ”€â”€ RUN_ID (PK)
â”œâ”€â”€ DATASET_ID (FK)
â”œâ”€â”€ START_TS
â”œâ”€â”€ END_TS
â”œâ”€â”€ STATUS (Running, Completed, Failed)
â””â”€â”€ TRIGGERED_BY (Scheduled, Manual, API)
-- Check results
DQ_CHECK_RESULTS
â”œâ”€â”€ CHECK_ID (PK)
â”œâ”€â”€ RUN_ID (FK)
â”œâ”€â”€ RULE_ID (FK)
â”œâ”€â”€ DATASET_ID (FK)
â”œâ”€â”€ COLUMN_NAME
â”œâ”€â”€ CHECK_TIMESTAMP
â”œâ”€â”€ PASSED (Boolean)
â”œâ”€â”€ FAILED_COUNT
â”œâ”€â”€ TOTAL_COUNT
â””â”€â”€ DQ_SCORE (0-100)
-- Failed record details
DQ_FAILED_RECORDS
â”œâ”€â”€ FAILED_RECORD_ID (PK)
â”œâ”€â”€ CHECK_ID (FK)
â”œâ”€â”€ RECORD_KEY
â”œâ”€â”€ FAILED_VALUE
â””â”€â”€ FAILURE_REASON
-- Column profiling
DQ_COLUMN_PROFILE
â”œâ”€â”€ PROFILE_ID (PK)
â”œâ”€â”€ DATASET_ID (FK)
â”œâ”€â”€ COLUMN_NAME
â”œâ”€â”€ PROFILE_TIMESTAMP
â”œâ”€â”€ DISTINCT_COUNT
â”œâ”€â”€ NULL_COUNT
â”œâ”€â”€ MIN_VALUE
â”œâ”€â”€ MAX_VALUE
â””â”€â”€ AVG_VALUE
-- Aggregated summaries
DQ_DAILY_SUMMARY
DQ_WEEKLY_SUMMARY
DQ_MONTHLY_SUMMARY
DQ_QUARTERLY_SUMMARY
DB_METRICS Schema (AI Observability)
-- Unified metrics for AI
DQ_METRICS
â”œâ”€â”€ METRIC_ID (PK)
â”œâ”€â”€ ASSET_ID (DATABASE.SCHEMA.TABLE)
â”œâ”€â”€ METRIC_NAME
â”œâ”€â”€ METRIC_VALUE
â”œâ”€â”€ METRIC_TIMESTAMP
â””â”€â”€ METADATA (JSON)
-- AI-generated insights
DQ_AI_INSIGHTS
â”œâ”€â”€ INSIGHT_ID (PK)
â”œâ”€â”€ ASSET_ID
â”œâ”€â”€ INSIGHT_TYPE (Anomaly, Trend, Recommendation)
â”œâ”€â”€ SEVERITY (Critical, Warning, Info)
â”œâ”€â”€ SUMMARY
â”œâ”€â”€ CONFIDENCE_SCORE
â””â”€â”€ CREATED_AT
-- Schema registry view for AI
V_SCHEMA_REGISTRY
â”œâ”€â”€ DATABASE_NAME
â”œâ”€â”€ SCHEMA_NAME
â”œâ”€â”€ TABLE_NAME
â”œâ”€â”€ COLUMN_NAME
â”œâ”€â”€ DATA_TYPE
â””â”€â”€ IS_NULLABLE
ğŸ”„ Data Flow
1. Data Ingestion Flow
CSV Files
    â†“
Snowflake Stage (@BANKING_DW.BRONZE.CSV_STAGE)
    â†“
BRONZE Layer (Raw, all STRING columns)
    â†“
SP_TRANSFORM_BRONZE_TO_SILVER
    â†“
SILVER Layer (Type-safe, with DQ scores)
    â†“
GOLD Layer (Analytics views)
2. DQ Check Execution Flow
Trigger (Manual/Scheduled/API)
    â†“
SP_EXECUTE_DQ_CHECKS
    â†“
Read DATASET_RULE_CONFIG
    â†“
For each rule:
    â”œâ”€â”€ Get SQL template
    â”œâ”€â”€ Substitute parameters
    â”œâ”€â”€ Execute query
    â”œâ”€â”€ Calculate DQ score
    â””â”€â”€ Insert into DQ_CHECK_RESULTS
    â†“
Update DQ_RUN_CONTROL (status, end time)
    â†“
Generate DQ_DAILY_SUMMARY
3. AI Investigation Flow
User Question
    â†“
/api/antigravity/ask-question
    â†“
Intent Classification (Gemini)
    â†“
Schema Introspection
    â†“
SQL Generation (AI with validation)
    â†“
Query Execution (Snowflake)
    â†“
Answer Interpretation
    â†“
Executive Answer Block (UI)
4. Profiling Flow
Trigger (Manual/Scheduled)
    â†“
SP_PROFILE_DATASET
    â†“
For each column:
    â”œâ”€â”€ COUNT(DISTINCT column)
    â”œâ”€â”€ COUNT(*) WHERE column IS NULL
    â”œâ”€â”€ MIN(column), MAX(column), AVG(column)
    â””â”€â”€ Data type distribution
    â†“
Insert into DQ_COLUMN_PROFILE
    â†“
Display in Column Statistics UI
ğŸ”Œ API Endpoints Summary
Data Quality APIs (/api/dq/) - 28 endpoints
Overall score, KPIs, check results
Run scans, profiling, custom rules
Historical data, trends, anomalies
Failed records, SLA compliance
Snowflake APIs (/api/snowflake/) - 17 endpoints
Connection management
Database/schema/table listing
Query execution
Context management
Antigravity APIs (/api/antigravity/) - 7 endpoints
Investigation sessions
Question answering
Evidence retrieval
Schema registry for AI
Observability APIs (/api/observability/) - 6 endpoints
Metrics ingestion
Insights generation
Historical backfill
ğŸ¨ UI Component Hierarchy
App Layout
â”œâ”€â”€ Sidebar (Navigation)
â”œâ”€â”€ TopNav (Connection status)
â””â”€â”€ Main Content
    â”œâ”€â”€ Dashboard (Home page)
    â”‚   â”œâ”€â”€ CircularMetricCard (3x KPIs)
    â”‚   â””â”€â”€ Attention Items
    â”œâ”€â”€ Dataset Detail Pages
    â”‚   â”œâ”€â”€ ColumnDetailPanel
    â”‚   â”œâ”€â”€ ColumnStatistics
    â”‚   â”œâ”€â”€ ColumnCheckResults
    â”‚   â””â”€â”€ ScheduleForm
    â””â”€â”€ AI Features
        â”œâ”€â”€ AntigravityInvestigation (Modal)
        â”œâ”€â”€ AntigravityInsights (Panel)
        â””â”€â”€ ExecutiveAnswerBlock
ğŸ”§ Configuration & Environment
Required Environment Variables
SNOWFLAKE_ACCOUNT=abc123def.us-east-1
SNOWFLAKE_USER=your_username
SNOWFLAKE_PASSWORD=your_password
SNOWFLAKE_WAREHOUSE=COMPUTE_WH
SNOWFLAKE_DATABASE=BANKING_DW
DQ_DATABASE=DATA_QUALITY_DB
Optional Variables
GEMINI_API_KEY=your_gemini_api_key
OLLAMA_BASE_URL=http://localhost:11434
NODE_ENV=development
PORT=3000
ğŸš€ Quick Start
# 1. Install dependencies
npm install
# 2. Configure environment
cp .env.example .env
# Edit .env with your Snowflake credentials
# 3. Run Snowflake setup scripts (in order)
# Execute sql/production/01-11_*.sql in Snowflake
# 4. Start development server
npm run dev
# 5. Access application
# Open http://localhost:3000
ğŸ“Š Key Metrics
Total Files: ~150+
Lines of Code: ~15,000+
API Endpoints: 65+
React Components: 45+
SQL Scripts: 12 production scripts
DQ Rules: 65+ pre-configured
Documentation Pages: 18+
ğŸ† Key Strengths
Comprehensive DQ Coverage: 65+ rules across 6 dimensions
AI-Powered Investigation: Unique Antigravity engine
Production-Ready: Complete with error handling, retry logic, caching
Well-Documented: Extensive documentation and troubleshooting guides
Modern Stack: Latest Next.js, React, TypeScript
Scalable Architecture: Connection pooling, caching, background jobs
Enterprise-Grade: Snowflake integration, RBAC, audit trails
Last Updated: January 27, 2026
Version: 1.0.0
Maintained By: Pi-Qualytics Team